#!/usr/bin/env bash

case $1 in

    "start")
        echo "Checking Spigot installation status..."
        spigot_version=$(/bin/bash /usr/local/spigot/spigot_version.sh)

        if [ "$spigot_version" = "NONE" ]
        then
            echo "Spigot is not installed. Installing now..."

            # Bail if installation failed.
            if ! /bin/bash /usr/local/spigot/spigot_install.sh
            then
                echo "Unable to start Spigot: Spigot installation failed."
                exit 1
            fi
        fi

        spigot_version=$(/bin/bash /usr/local/spigot/spigot_version.sh)
        echo "Starting Spigot server $spigot_version..."
        if ! /bin/bash /usr/local/spigot/spigot_start.sh
        then
            echo "Failed to start Spigot server."
            exit 1
        fi

        echo "Spigot server has stopped."
        echo "Sleeping for 2 minutes."
        sleep 120
        exit 0
    ;;

    "stop")
        echo "Stop"
    ;;

    *)
        echo "Unrecognized command"
    ;;
esac

exit 0
