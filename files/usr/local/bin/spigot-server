#!/usr/bin/env bash

case $1 in

    "start")
        echo "Checking Spigot installation status..."
        spigot_version=$(/bin/bash /usr/local/spigot/spigot_version.sh)

        if [ "$spigot_version" = "NONE" ]
        then
            echo "Spigot is not installed. Installing now..."

            # Bail if installation failed.
            if ! /bin/bash /usr/local/spigot/spigot_install.sh
            then
                echo "Unable to start Spigot: Spigot installation failed."
                exit 1
            fi

            # Output Spigot installation version
            spigot_version=$(/bin/bash /usr/local/spigot/spigot_version.sh)
            echo "Installed Spigot $spigot_version"
        fi

        echo "Starting Spigot server..."
        if [ "$(bootstrap)" = "0" ]
        then
            echo "Waiting!"
            numseconds=$(/bin/bash /usr/local/spigot/spigot_start.sh)
            wait
            sleep "$numseconds"
            echo "Done!"
            exit $?
        fi
    ;;

    "stop")
        echo "Stop"
    ;;

    *)
        echo "Unrecognized command"
    ;;
esac

exit 0
